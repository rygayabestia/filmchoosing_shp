<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ movie.title }}</title>
</head>
<body>
    <div class="movie-container">
        <h1>{{ movie.title }}</h1>
    <p class="genres">
        –ñ–∞–Ω—Ä—ã:
        {% for genre, value in filtered_genres.items %}
            {{ genre }}{% if not forloop.last %}, {% endif %}
        {% empty %}
            –ñ–∞–Ω—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã
        {% endfor %}
    </p>
        <div class="movie-rating">
    <h3>–†–µ–π—Ç–∏–Ω–≥: {{ movie.rating|floatformat:1 }}/5</h3>
    <div class="rating-stars">
        <form method="post" action="{% url 'rate_movie' movie.id %}">
            {% csrf_token %}
            {% for i in "54321" %}
                <button type="submit" name="rating" value="{{ i }}"
                        class="star {% if movie.rating >= i|add:0 %}active{% endif %}">
                    ‚òÖ
                </button>
            {% endfor %}
        </form>
    </div>
    <p>–û—Ü–µ–Ω–æ–∫: {{ movie.rating_count }}</p>
</div>

        <!-- –í–∏–¥–µ–æ–ø–ª–µ–µ—Ä –∏–ª–∏ —Ñ–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="video-section">
            {% if movie.video_file %}
            <div class="video-player">
                <video width="640" height="360" controls>
                    <source src="{{ movie.video_file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            {% else %}
                {% if request.user.is_superuser %}
                <div class="upload-form">
                    <h3>Upload Video for this Movie</h3>
                    <form method="post" enctype="multipart/form-data" action="{% url 'upload_movie_video' movie.id %}">
                        {% csrf_token %}
                        <input type="file" name="video_file" accept="video/mp4" required>
                        <button type="submit" class="btn-upload">Upload Video</button>
                    </form>
                </div>
                {% else %}
                <p class="no-video">Video player is not available for this movie.</p>
                {% endif %}
            {% endif %}
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
        <div class="action-buttons">
            <a href="{% url 'like_movie' movie.movie_id %}" class="btn-like">
                {% if request.user.is_authenticated and movie in request.user.liked_movies.all %}
                    ‚ù§Ô∏è Unlike
                {% else %}
                    ü§ç Like
                {% endif %}
            </a>
            <a href="{% url 'movie_list' %}" class="btn-back">‚Üê Back to list</a>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
        <div class="comments-section">
            <h2>Comments</h2>

            {% if not comments %}
                <p class="no-comments">No comments yet. Be the first to comment!</p>
            {% else %}
                {% for comment in comments %}
                    <div class="comment">
                        <div class="comment-header">
                            <strong class="comment-author">{{ comment.user.username }}</strong>
                            <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                        </div>
                        <p class="comment-text">{{ comment.text }}</p>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            {% if request.user.is_authenticated %}
            <div class="comment-form">
                <h3>Add your comment</h3>
                <form method="post">
                    {% csrf_token %}
                    <textarea name="text" class="form-control" rows="3" required></textarea>
                    <button type="submit" class="btn-submit">Post Comment</button>
                </form>
            </div>
            {% else %}
            <p class="login-to-comment"><a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to leave a comment.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>